var Ease={EASE:"ease",EASE_IN:"ease-in",EASE_OUT:"ease-out",EASE_IN_OUT:"ease-in-out",LINEAR:"linear"},TimelineEvent={START:"start",RESUME:"resume",PAUSE:"pause",FINISH:"finish"};function Timeline(){return this._currentKeyframe="",this._timer=-1,this._timerRunning=!1,this._counter=0,this._keyframes={},this._length=0,this._events=[],this}Timeline._tickRate=50,Timeline._getStyleValue=function(e,t){var i=document.getElementById(e);return i.currentStyle?i=i.currentStyle[t]:window.getComputedStyle&&(i=document.defaultView.getComputedStyle(i).getPropertyValue(t)),i},Timeline._performTimeCleanup=function(e){"string"!=typeof e&&window.alert("Please provide a time value in milliseconds or seconds."),-1===e.indexOf("ms")&&-1!==e.indexOf("s")&&(e=1e3*parseFloat(e.replace("s",""))+"ms");var t=e.lastIndexOf("ms")-1,i=e.charAt(t);if("0"!==i&&(e=e.substring(0,t)+"0ms"),t=e.lastIndexOf("ms")-2,"0"!==(i=e.charAt(t))||"5"!==i){var n=parseInt(i)-5;n=n<3||n>-3?0:5,e=e.substring(0,t)+n+"0ms"}return e},Timeline._performEaseCheck=function(e){return void 0===e?Ease.EASE:(e!==Ease.EASE&&e!==Ease.EASE_IN&&e!==Ease.EASE_OUT&&e!==Ease.EASE_IN_OUT&&e!==Ease.LINEAR&&window.alert("Please provide a valid option for the ease type. This can be Ease.EASE, Ease.EASE_IN, Ease.EASE_OUT, Ease.EASE_IN_OUT, or Ease.LINEAR. The ease parameter can also be left blank and it will default to an easing type of Ease.EASE."),e)},Timeline._generateTransitions=function(e,t,i,n,s){return{htmlObject:e,dur:t,es:s,trans:i+" "+t+" "+s,props:[{prop:i,val:n}]}},Timeline.prototype._onWindowFocus=function(e){window.top.removeEventListener("focus",this._onWindowFocus),window.top.addEventListener("blur",this._onWindowBlur),this._timer=setTimeout(this._onTimerTick.bind(this),Timeline._tickRate)},Timeline.prototype._onWindowBlur=function(e){window.top.addEventListener("focus",this._onWindowFocus),window.top.removeEventListener("blur",this._onWindowBlur),this._timer||clearTimeout(this._timer)},Timeline.prototype._onTimerTick=function(e){var t,i,n=this._counter+"ms",s=this._counter+2*Timeline._tickRate+"ms",r=0,o=0;if(this._keyframes[s])for(;r<this._keyframes[s].length;)i=-1!==this._keyframes[s][r].trans.indexOf("transform"),(t=document.getElementById(this._keyframes[s][r].htmlObject)).style["-webkit-transition"]=!0===i?"-webkit-":""+this._keyframes[s][r].trans,t.style["-moz-transition"]=!0===i?"-moz-":""+this._keyframes[s][r].trans,t.style["-o-transition"]=!0===i?"-o-":""+this._keyframes[s][r].trans,t.style.transition=this._keyframes[s][r].trans,r+=1;if(r=0,this._keyframes[n]){for(;r<this._keyframes[n].length;){var a=0;for(t=document.getElementById(this._keyframes[n][r].htmlObject);a<this._keyframes[n][r].props.length;)1===this._length&&Number(this._keyframes[n][r].dur.replace("ms",""))>o&&(o=Number(this._keyframes[n][r].dur.replace("ms",""))),t.style[this._keyframes[n][r].props[a].prop]=this._keyframes[n][r].props[a].val,a+=1;r+=1}this._length-=1}this._counter+=Timeline._tickRate,0!==this._length?this._timer=setTimeout(this._onTimerTick.bind(this),Timeline._tickRate):setTimeout(this.dispatchEvent.bind(this),o,TimelineEvent.FINISH)},Timeline.prototype.addKeyframe=function(e){return e=Timeline._performTimeCleanup(e),this._currentKeyframe=e,this._keyframes[this._currentKeyframe]||(this._keyframes[this._currentKeyframe]=[],this._length+=1),this},Timeline.prototype.makeStyleChange=function(e,t,i,n,s){t=Timeline._performTimeCleanup(t),s=Timeline._performEaseCheck(s);var r=Timeline._generateTransitions(e,t,i,n,s),o=document.getElementById(e),a=-1!==r.trans.indexOf("transform");return o.style["-webkit-transition"]=!0===a?"-webkit-":""+r.trans,o.style["-moz-transition"]=!0===a?"-moz-":""+r.trans,o.style["-o-transition"]=!0===a?"-o-":""+r.trans,o.style.transition=r.trans,o.style[r.props[0].prop]=r.props[0].val,this},Timeline.prototype.addStyleChange=function(e,t,i,n,s){if("0ms"===this._currentKeyframe||"50ms"===this._currentKeyframe)return this.makeStyleChange(e,t,i,n,s);t=Timeline._performTimeCleanup(t),s=Timeline._performEaseCheck(s);for(var r=Timeline._generateTransitions(e,t,i,n,s),o=!1,a=0;a<this._keyframes[this._currentKeyframe].length;){if(this._keyframes[this._currentKeyframe][a].htmlObject===r.htmlObject){this._keyframes[this._currentKeyframe][a].props=this._keyframes[this._currentKeyframe][a].props.concat(r.props),this._keyframes[this._currentKeyframe][a].trans+=", "+r.trans,o=!0;break}a+=1}return!1===o&&this._keyframes[this._currentKeyframe].push(r),this},Timeline.prototype.play=function(){return!1===this._timerRunning&&(this.dispatchEvent(0===this._counter?TimelineEvent.START:TimelineEvent.RESUME),this._timer=setTimeout(this._onTimerTick.bind(this),Timeline._tickRate),this._timerRunning=!0),this},Timeline.prototype.pause=function(){return!0===this._timerRunning&&(this.dispatchEvent(TimelineEvent.PAUSE),clearTimeout(this._timer),this._timerRunning=!1),this},Timeline.prototype.addEventListener=function(e,t){this._events[e]=this._events[e]||[],this._events[e]&&this._events[e].push(t)},Timeline.prototype.removeEventListener=function(e,t){if(this._events[e])for(var i=this._events[e],n=i.length;n--;)if(i[n]===t)return i.splice(n,1),!0;return!1},Timeline.prototype.dispatchEvent=function(e){if(this._events[e])for(var t=this._events[e],i=t.length;i--;)t[i](this)},Timeline.prototype.addFocusListener=function(){window.top.addEventListener("blur",this._onWindowBlur)},Timeline.prototype.removeFocusListener=function(){window.top.removeEventListener("blur",this._onWindowBlur)};